{"version":3,"file":"aframe-stock-ticker.modern.js","sources":["../src/stock-ticker.js"],"sourcesContent":["//requires an API key\r\nAFRAME.registerComponent('stock-chart', {\r\n  schema: {\r\n    symbol: { default: 'ETH/USD' }, // AAPL, EUR/USD, ETH/BTC, see https://rapidapi.com/twelvedata/api/twelve-data1\r\n    interval: { default: '15min' }, // see https://rapidapi.com/twelvedata/api/twelve-data1\r\n    length: { default: 100 },\r\n    refreshRate: { default: 5 }, //updates every x minutes\r\n    width: { default: 4 },\r\n    height: { default: 2 },\r\n    enableBackground: { default: true },\r\n    backgroundColor: { default: '#333' },\r\n    enableTitle: { default: true },\r\n    enablePrices: { default: true },\r\n    enableWicks: { default: true },\r\n    coloredWicks: { default: true },\r\n  },\r\n\r\n  init: function () {\r\n    const data = this.data;\r\n\r\n    //get data on a timer\r\n    setInterval(\r\n      requestData(data.symbol, data.interval, data.length, window.TWELVE_API_KEY).then((timeseries) => {\r\n        data.timeseries = timeseries;\r\n        this.updateChart();\r\n      }),\r\n      data.refreshRate * 1000 * 60\r\n    );\r\n  },\r\n\r\n  updateChart: function () {\r\n    const el = this.el;\r\n    const data = this.data;\r\n    const { length: length, width: width, height: height, timeseries: timeseries } = data;\r\n    const values = timeseries.values;\r\n\r\n    //clear previous chart\r\n    while (el.firstChild) {\r\n      el.firstChild.remove();\r\n    }\r\n\r\n    //determine chart scale\r\n    const highs = values.map((item) => {\r\n      return item.high;\r\n    });\r\n    const lows = values.map((item) => {\r\n      return item.low;\r\n    });\r\n    const seriesMax = Math.max(...highs);\r\n    const seriesMin = Math.min(...lows);\r\n\r\n    //converts a price to a y positon on the chart\r\n    function scaleToChart(value) {\r\n      return ((value - seriesMin) / (seriesMax - seriesMin)) * height;\r\n    }\r\n\r\n    //create the candles\r\n    const candleWidth = width / length;\r\n    let i = 0;\r\n    values.forEach((candle) => {\r\n      i++;\r\n      const bar = document.createElement('a-box');\r\n      el.appendChild(bar);\r\n\r\n      bar.setAttribute('width', candleWidth);\r\n      bar.setAttribute('depth', candleWidth);\r\n\r\n      const candleHeight = scaleToChart(candle.open) - scaleToChart(candle.close);\r\n      bar.setAttribute('height', Math.abs(candleHeight));\r\n\r\n      const x = i * candleWidth - candleWidth / 2;\r\n      const heightAdj = candleHeight < 0 ? Math.abs(candleHeight) / 2 : Math.abs(candleHeight) / -2;\r\n      const y = scaleToChart(candle.open) + heightAdj;\r\n      bar.setAttribute('position', `${x} ${y} 0`);\r\n\r\n      const color = candleHeight < 0 ? '#f44' : '#4f4';\r\n      bar.setAttribute('color', color);\r\n\r\n      //create wick\r\n      if (data.enableWicks == true) {\r\n        const wick = document.createElement('a-box');\r\n        bar.appendChild(wick);\r\n\r\n        wick.setAttribute('width', candleWidth / 5);\r\n        wick.setAttribute('depth', candleWidth / 5);\r\n\r\n        const wickHeight = scaleToChart(candle.high) - scaleToChart(candle.low);\r\n        wick.setAttribute('height', wickHeight + 0.01); // 0.01 is to avoid texture collisions with the candle\r\n\r\n        if (data.coloredWicks == true) {\r\n          wick.setAttribute('color', color);\r\n        } else {\r\n          wick.setAttribute('color', '#000');\r\n        }\r\n      }\r\n    });\r\n\r\n    //add background\r\n    if (data.enableBackground == true) {\r\n      const background = document.createElement('a-box');\r\n      el.appendChild(background);\r\n\r\n      const backgroundDepth = 0.05;\r\n      background.setAttribute('width', width);\r\n      background.setAttribute('height', height);\r\n      background.setAttribute('depth', backgroundDepth);\r\n      background.setAttribute('color', data.backgroundColor);\r\n      background.setAttribute('position', `${width / 2} ${height / 2} ${(-candleWidth - backgroundDepth) / 2}`);\r\n    }\r\n\r\n    //add title\r\n    if (data.enableTitle == true) {\r\n      const title = document.createElement('a-text');\r\n      el.appendChild(title);\r\n\r\n      const text = `${timeseries.meta.symbol} | ${timeseries.meta.interval}`;\r\n      title.setAttribute('value', text);\r\n      title.setAttribute('font', 'roboto');\r\n\r\n      const y = 0.155;\r\n      title.setAttribute('position', `0 ${y} ${-candleWidth / 2}`);\r\n    }\r\n\r\n    //add prices\r\n    if (data.enablePrices == true) {\r\n      const heightAdj = 0.1;\r\n\r\n      const priceLow = document.createElement('a-text');\r\n      el.appendChild(priceLow);\r\n      priceLow.setAttribute('scale', '.75 .75 1');\r\n      priceLow.setAttribute('font', 'roboto');\r\n      priceLow.setAttribute('align', 'right');\r\n      priceLow.setAttribute('value', `${Math.round(seriesMin * 100) / 100}`);\r\n      priceLow.setAttribute('position', `${width} ${heightAdj} ${-candleWidth / 2}`);\r\n\r\n      const priceHigh = document.createElement('a-text');\r\n      el.appendChild(priceHigh);\r\n      priceHigh.setAttribute('scale', '.75 .75 1');\r\n      priceHigh.setAttribute('font', 'roboto');\r\n      priceHigh.setAttribute('align', 'right');\r\n      priceHigh.setAttribute('value', `${Math.round(seriesMax * 100) / 100}`);\r\n      priceHigh.setAttribute('position', `${width} ${height - heightAdj} ${-candleWidth / 2}`);\r\n    }\r\n  },\r\n});\r\n\r\nfunction requestData(symbol, interval, length, apiKey) {\r\n  return new Promise((resolve, reject) => {\r\n    fetch(\r\n      `https://twelve-data1.p.rapidapi.com/time_series?symbol=${symbol}&interval=${interval}&outputsize=${length}&format=json`,\r\n      {\r\n        method: 'GET',\r\n        headers: {\r\n          'x-rapidapi-key': apiKey,\r\n          'x-rapidapi-host': 'twelve-data1.p.rapidapi.com',\r\n        },\r\n      }\r\n    )\r\n      .then((response) => {\r\n        response.json().then((data) => {\r\n          resolve(data);\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        reject(err);\r\n      });\r\n  });\r\n}\r\n"],"names":["AFRAME","registerComponent","schema","symbol","default","interval","length","refreshRate","width","height","enableBackground","backgroundColor","enableTitle","enablePrices","enableWicks","coloredWicks","init","data","this","apiKey","setInterval","window","TWELVE_API_KEY","Promise","resolve","reject","fetch","method","headers","x-rapidapi-key","x-rapidapi-host","then","response","json","catch","err","timeseries","updateChart","el","values","firstChild","remove","highs","map","item","high","lows","low","seriesMax","Math","max","seriesMin","min","scaleToChart","value","candleWidth","i","forEach","candle","bar","document","createElement","appendChild","setAttribute","candleHeight","open","close","abs","x","heightAdj","y","color","wick","wickHeight","background","backgroundDepth","title","meta","priceLow","round","priceHigh"],"mappings":"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"}